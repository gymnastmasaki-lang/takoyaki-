<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive">
    <title>ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†ç”»é¢ - åº—èˆ—ç®¡ç†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.2s ease-out;
        }
        
        .animate-slideUp {
            animation: slideUp 0.3s ease-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- FirebaseåˆæœŸåŒ– -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, getDoc, addDoc, onSnapshot, updateDoc, deleteDoc, doc, setDoc, query, where, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBoSdfEkez-b3P0BUHtowxCrTw-yEBdHSg",
            authDomain: "takoyaki-order-system-bacd7.firebaseapp.com",
            projectId: "takoyaki-order-system-bacd7",
            storageBucket: "takoyaki-order-system-bacd7.firebasestorage.app",
            messagingSenderId: "104494752890",
            appId: "1:104494752890:web:c0a25d62f42ffca01687c3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const auth = getAuth(app);

        window.db = db;
        window.storage = storage;
        window.auth = auth;
        window.firebaseModules = { 
            collection, getDocs, getDoc, addDoc, onSnapshot, 
            updateDoc, deleteDoc, doc, setDoc, query, where, Timestamp,
            ref, uploadBytes, getDownloadURL, signInAnonymously
        };
        window.FirebaseReady = true;
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯ç’°å¢ƒå¤‰æ•°ãªã©ã§ç®¡ç†ï¼‰
        const SUPER_ADMIN_PASSWORD = 'SUPER2025ADMIN';

        // ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        const CustomModal = ({ isOpen, onClose, type, title, message }) => {
            if (!isOpen) return null;
            
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸',
                confirm: 'â“'
            };
            
            const colors = {
                success: 'from-green-500 to-green-600',
                error: 'from-red-500 to-red-600',
                warning: 'from-yellow-500 to-yellow-600',
                info: 'from-blue-500 to-blue-600',
                confirm: 'from-purple-500 to-purple-600'
            };
            
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 animate-fadeIn">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full animate-slideUp">
                        <div className="text-center">
                            <div className="text-6xl mb-4">{icons[type] || icons.info}</div>
                            <h3 className="text-2xl font-bold text-gray-800 mb-4">{title}</h3>
                            <p className="text-gray-600 mb-6 whitespace-pre-line">{message}</p>
                            <button
                                onClick={onClose}
                                className={`w-full bg-gradient-to-r ${colors[type] || colors.info} text-white py-3 rounded-lg font-bold hover:opacity-90 transition-all`}
                            >
                                OK
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        const ConfirmModal = ({ isOpen, onClose, onConfirm, title, message }) => {
            if (!isOpen) return null;
            
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 animate-fadeIn">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full animate-slideUp">
                        <div className="text-center">
                            <div className="text-6xl mb-4">â“</div>
                            <h3 className="text-2xl font-bold text-gray-800 mb-4">{title}</h3>
                            <p className="text-gray-600 mb-6 whitespace-pre-line">{message}</p>
                            <div className="flex gap-3">
                                <button
                                    onClick={onClose}
                                    className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400 transition-all"
                                >
                                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                </button>
                                <button
                                    onClick={() => {
                                        onConfirm();
                                        onClose();
                                    }}
                                    className="flex-1 bg-gradient-to-r from-red-500 to-red-600 text-white py-3 rounded-lg font-bold hover:opacity-90 transition-all"
                                >
                                    ç¢ºèª
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const SuperAdminSystem = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [passwordInput, setPasswordInput] = useState('');
            const [stores, setStores] = useState([]);
            const [showAddStore, setShowAddStore] = useState(false);
            const [editingStore, setEditingStore] = useState(null);
            const [formData, setFormData] = useState({
                storeName: '',
                storePassword: '',
                isActive: true,
                createMode: 'new',  // 'new' ã¾ãŸã¯ 'copy'
                sourceStoreId: ''   // ã‚³ãƒ”ãƒ¼å…ƒåº—èˆ—ID
            });
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®state
            const [modal, setModal] = useState({ isOpen: false, type: 'info', title: '', message: '' });
            const [confirmModal, setConfirmModal] = useState({ isOpen: false, title: '', message: '', onConfirm: () => {} });
            const [showCopyDialog, setShowCopyDialog] = useState(false);  // ğŸ†• ã‚³ãƒ”ãƒ¼å…ƒé¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°
            
            // ğŸ†• æ—¥è¨ˆè¡¨å‡ºåŠ›ç”¨ã®state
            const [showDailyReportModal, setShowDailyReportModal] = useState(false);
            const [selectedStore, setSelectedStore] = useState(null);
            const [reportYear, setReportYear] = useState(new Date().getFullYear());
            const [reportMonth, setReportMonth] = useState(new Date().getMonth() + 1);
            const [reportDay, setReportDay] = useState(new Date().getDate());
            
            // ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆé–¢æ•°
            const showAlert = (type, title, message) => {
                setModal({ isOpen: true, type, title, message });
            };
            
            // ã‚«ã‚¹ã‚¿ãƒ ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°é–¢æ•°
            const showConfirm = (title, message, onConfirm) => {
                setConfirmModal({ isOpen: true, title, message, onConfirm });
            };

            // åº—èˆ—ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿
            useEffect(() => {
                if (!isAuthenticated) return;

                const loadStores = async () => {
                    const { collection, onSnapshot } = window.firebaseModules;
                    const storesRef = collection(window.db, 'stores');
                    
                    onSnapshot(storesRef, (snapshot) => {
                        const storesList = [];
                        snapshot.forEach((doc) => {
                            storesList.push({ id: doc.id, ...doc.data() });
                        });
                        setStores(storesList);
                    });
                };

                loadStores();
            }, [isAuthenticated]);

            // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
            const handleLogin = (e) => {
                e.preventDefault();
                if (passwordInput === SUPER_ADMIN_PASSWORD) {
                    setIsAuthenticated(true);
                    sessionStorage.setItem('superAdminAuth', 'true');
                } else {
                    showAlert('error', 'ã‚¨ãƒ©ãƒ¼', 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                    setPasswordInput('');
                }
            };

            // åº—èˆ—è¿½åŠ 
            const handleAddStore = async (e) => {
                e.preventDefault();
                
                if (!formData.storeName || !formData.storePassword) {
                    showAlert('warning', 'å…¥åŠ›ã‚¨ãƒ©ãƒ¼', 'åº—èˆ—åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                if (formData.createMode === 'copy' && !formData.sourceStoreId) {
                    showAlert('warning', 'é¸æŠã‚¨ãƒ©ãƒ¼', 'ã‚³ãƒ”ãƒ¼å…ƒã®åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }

                try {
                    const { collection, setDoc, doc, Timestamp, getDocs } = window.firebaseModules;
                    
                    // åº—èˆ—IDã‚’ç”Ÿæˆï¼ˆåº—èˆ—åã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸå®‰å…¨ãªIDï¼‰
                    const storeId = formData.storeName.replace(/\s+/g, '_').toLowerCase();
                    
                    const storeData = {
                        storeName: formData.storeName,
                        storePassword: formData.storePassword,
                        isActive: formData.isActive,
                        createdAt: Timestamp.now(),
                        updatedAt: Timestamp.now()
                    };

                    await setDoc(doc(window.db, 'stores', storeId), storeData);

                    // åˆæœŸãƒ†ãƒ¼ãƒ–ãƒ«è¨­å®šã‚’ä½œæˆï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã‚³ãƒ”ãƒ¼ã—ãªã„ï¼‰
                    const initialTables = [
                        { id: 'sokukaikei', name: 'å³ä¼šè¨ˆ', status: 'empty', order: null },
                        { id: 'takeout', name: 'ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆ', status: 'empty', order: null }
                    ];

                    await setDoc(doc(window.db, 'store_tables', storeId), {
                        tables: initialTables,
                        updatedAt: Timestamp.now()
                    });

                    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚³ãƒ”ãƒ¼å‡¦ç†
                    if (formData.createMode === 'copy') {
                        // ã‚³ãƒ”ãƒ¼å…ƒã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å–å¾—ï¼ˆæ–°ã—ã„æ§‹é€ ï¼‰
                        const sourceMenusRef = collection(window.db, 'stores', formData.sourceStoreId, 'menus');
                        const sourceMenusSnapshot = await getDocs(sourceMenusRef);
                        
                        if (!sourceMenusSnapshot.empty) {
                            // æ–°ã—ã„åº—èˆ—ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼
                            const copyPromises = [];
                            sourceMenusSnapshot.forEach((menuDoc) => {
                                const menuData = menuDoc.data();
                                const newMenuRef = doc(window.db, 'stores', storeId, 'menus', menuDoc.id);
                                copyPromises.push(setDoc(newMenuRef, menuData));
                            });
                            await Promise.all(copyPromises);
                            console.log(`âœ… ${sourceMenusSnapshot.size}ä»¶ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ`);
                        } else {
                            console.log('âš ï¸ ã‚³ãƒ”ãƒ¼å…ƒã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“');
                        }
                    }

                    showAlert('success', 'å®Œäº†', formData.createMode === 'copy' 
                        ? 'åº—èˆ—ã‚’è¿½åŠ ã—ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ' 
                        : 'åº—èˆ—ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
                    setShowAddStore(false);
                    setFormData({ 
                        storeName: '', 
                        storePassword: '', 
                        isActive: true,
                        createMode: 'new',
                        sourceStoreId: ''
                    });
                } catch (error) {
                    console.error('åº—èˆ—è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
                    showAlert('error', 'ã‚¨ãƒ©ãƒ¼', 'åº—èˆ—ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            };

            // åº—èˆ—ç·¨é›†
            const handleEditStore = async (e) => {
                e.preventDefault();
                
                if (!formData.storeName || !formData.storePassword) {
                    showAlert('warning', 'å…¥åŠ›ã‚¨ãƒ©ãƒ¼', 'åº—èˆ—åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }

                try {
                    const { updateDoc, doc, Timestamp } = window.firebaseModules;
                    
                    await updateDoc(doc(window.db, 'stores', editingStore.id), {
                        storeName: formData.storeName,
                        storePassword: formData.storePassword,
                        isActive: formData.isActive,
                        updatedAt: Timestamp.now()
                    });

                    showAlert('success', 'å®Œäº†', 'åº—èˆ—æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
                    setEditingStore(null);
                    setFormData({ 
                        storeName: '', 
                        storePassword: '', 
                        isActive: true,
                        createMode: 'new',
                        sourceStoreId: ''
                    });
                } catch (error) {
                    console.error('åº—èˆ—æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                    showAlert('error', 'ã‚¨ãƒ©ãƒ¼', 'åº—èˆ—æƒ…å ±ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            };

            // ğŸ†• ä»–åº—èˆ—ã‹ã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼
            const handleCopyFromStore = async (sourceStoreId) => {
                if (!editingStore) return;
                
                try {
                    const { doc, getDoc, setDoc, collection, getDocs } = window.firebaseModules;
                    
                    console.log('ğŸ“‹ ã‚³ãƒ”ãƒ¼é–‹å§‹:', {
                        ã‚³ãƒ”ãƒ¼å…ƒ: sourceStoreId,
                        ã‚³ãƒ”ãƒ¼å…ˆ: editingStore.id
                    });
                    
                    // 1. menusã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ”ãƒ¼
                    let sourceMenusRef;
                    if (sourceStoreId === '' || sourceStoreId === 'shimoakatsuka' || sourceStoreId === 'ä¸‹èµ¤å¡š') {
                        // ä¸‹èµ¤å¡šï¼ˆãƒ«ãƒ¼ãƒˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼‰- æ—§ãƒ‡ãƒ¼ã‚¿ã¯'menu'
                        sourceMenusRef = collection(window.db, 'menu');
                        console.log('ğŸ“ ã‚³ãƒ”ãƒ¼å…ƒ: æ—§ãƒ‘ã‚¹ menu ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³');
                    } else {
                        sourceMenusRef = collection(window.db, 'stores', sourceStoreId, 'menus');
                        console.log('ğŸ“ ã‚³ãƒ”ãƒ¼å…ƒ: stores/' + sourceStoreId + '/menus');
                    }
                    
                    const menusSnapshot = await getDocs(sourceMenusRef);
                    console.log('ğŸ“Š å–å¾—ã—ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°:', menusSnapshot.size);
                    
                    let copiedCount = 0;
                    for (const menuDoc of menusSnapshot.docs) {
                        const menuData = menuDoc.data();
                        console.log('ğŸ“„ ã‚³ãƒ”ãƒ¼ä¸­:', menuDoc.id, menuData);
                        
                        const targetMenuRef = doc(window.db, 'stores', editingStore.id, 'menus', menuDoc.id);
                        await setDoc(targetMenuRef, menuData);
                        copiedCount++;
                    }
                    
                    console.log(`âœ… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ: ${copiedCount}ä»¶`);
                    
                    // 2. menu_settings ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆã‚«ãƒ†ã‚´ãƒªã‚„è¨­å®šï¼‰
                    let sourceMenuSettingsPath;
                    if (sourceStoreId === '' || sourceStoreId === 'shimoakatsuka' || sourceStoreId === 'ä¸‹èµ¤å¡š') {
                        sourceMenuSettingsPath = doc(window.db, 'menu_settings', 'shimoakatsuka');
                        console.log('ğŸ“ è¨­å®šã‚³ãƒ”ãƒ¼å…ƒ: menu_settings/shimoakatsuka');
                    } else {
                        sourceMenuSettingsPath = doc(window.db, 'stores', sourceStoreId, 'menu_settings', 'default');
                        console.log('ğŸ“ è¨­å®šã‚³ãƒ”ãƒ¼å…ƒ: stores/' + sourceStoreId + '/menu_settings/default');
                    }
                    
                    const targetMenuSettingsPath = doc(window.db, 'stores', editingStore.id, 'menu_settings', 'default');
                    
                    const menuSettingsDoc = await getDoc(sourceMenuSettingsPath);
                    if (menuSettingsDoc.exists()) {
                        await setDoc(targetMenuSettingsPath, menuSettingsDoc.data());
                        console.log('âœ… ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¨­å®šã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
                    } else {
                        console.log('âš ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                    }
                    
                    if (copiedCount === 0) {
                        showAlert('warning', 'æ³¨æ„', 'ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\nã‚³ãƒ”ãƒ¼å…ƒã®åº—èˆ—ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    } else {
                        showAlert('success', 'ã‚³ãƒ”ãƒ¼å®Œäº†', `ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ\n\nå•†å“æ•°: ${copiedCount}ä»¶`);
                    }
                    
                } catch (error) {
                    console.error('ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
                    showAlert('error', 'ã‚¨ãƒ©ãƒ¼', 'ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            };

            // åº—èˆ—å‰Šé™¤
            const handleDeleteStore = (storeId, storeName) => {
                showConfirm(
                    'åº—èˆ—å‰Šé™¤',
                    `æœ¬å½“ã«ã€Œ${storeName}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`,
                    async () => {
                        try {
                            const { deleteDoc, doc } = window.firebaseModules;
                            
                            await deleteDoc(doc(window.db, 'stores', storeId));
                            await deleteDoc(doc(window.db, 'store_tables', storeId));
                            await deleteDoc(doc(window.db, 'store_menus', storeId));

                            showAlert('success', 'å®Œäº†', 'åº—èˆ—ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                        } catch (error) {
                            console.error('åº—èˆ—å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                            showAlert('error', 'ã‚¨ãƒ©ãƒ¼', 'åº—èˆ—ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
                        }
                    }
                );
            };

            // æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ
            const toggleStoreActive = async (storeId, currentStatus) => {
                try {
                    const { updateDoc, doc, Timestamp } = window.firebaseModules;
                    
                    await updateDoc(doc(window.db, 'stores', storeId), {
                        isActive: !currentStatus,
                        updatedAt: Timestamp.now()
                    });
                } catch (error) {
                    console.error('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                    showAlert('error', 'ã‚¨ãƒ©ãƒ¼', 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            };
            
            // æ—¥è¨ˆè¡¨ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
            const openDailyReportModal = (store) => {
                setSelectedStore(store);
                const now = new Date();
                setReportYear(now.getFullYear());
                setReportMonth(now.getMonth() + 1);
                setReportDay(now.getDate());
                setShowDailyReportModal(true);
            };
            
            // æ—¥è¨ˆè¡¨ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            const closeDailyReportModal = () => {
                setShowDailyReportModal(false);
                setSelectedStore(null);
            };
            
            // æ—¥è¨ˆè¡¨ã‚’ç”Ÿæˆï¼ˆpos.htmlã¨åŒã˜å½¢å¼ï¼‰
            const generateDailyReport = async () => {
                if (!selectedStore) return;
                
                try {
                    showAlert('info', 'å‡¦ç†ä¸­', 'æ—¥è¨ˆè¡¨ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™...');
                    
                    const year = reportYear;
                    const month = reportMonth;
                    const endDay = reportDay; // é¸æŠã—ãŸæ—¥ã¾ã§å‡ºåŠ›
                    
                    console.log(`ğŸ“Š ${year}å¹´${month}æœˆ1æ—¥ã€œ${endDay}æ—¥ã®æ—¥è¨ˆè¡¨ã‚’ç”Ÿæˆä¸­...`);
                    
                    // Firestoreã‹ã‚‰å½“æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                    const { collection, getDocs, getDoc, doc } = window.firebaseModules;
                    const dailySalesRef = collection(window.db, 'stores', selectedStore.id, 'dailySales');
                    const dailySalesSnapshot = await getDocs(dailySalesRef);
                    
                    // æ—¥ä»˜ã”ã¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ•´ç†
                    const salesByDate = {};
                    dailySalesSnapshot.forEach(docData => {
                        const data = docData.data();
                        const date = data.date;
                        
                        // å½“æœˆã®ãƒ‡ãƒ¼ã‚¿ã®ã¿
                        if (date && date.startsWith(`${year}-${String(month).padStart(2, '0')}`)) {
                            salesByDate[date] = data;
                        }
                    });
                    
                    console.log('å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿:', salesByDate);
                    
                    // Excelãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
                    const excelData = [];
                    
                    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ1ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‰
                    excelData.push(['', 'å£²ä¸Šæ—¥è¨ˆè¡¨', '', '', '', '', '', '', '', '', selectedStore.storeName, '', '', '']);
                    excelData.push(['', '', '', '', '', '', '', '', '', '', '', '', '', '']);
                    excelData.push(['', `${year}-${String(month).padStart(2, '0')}-01`, '', '', '', '', '', '', '', '', '', '', '', '']);
                    excelData.push(['', '', '', '', '', '', '', '', '', '', '', '', '', '']);
                    
                    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ2ï¼ˆåˆ—åï¼‰
                    excelData.push(['', 'æ—¥', 'æ›œæ—¥', 'ä¼ç¥¨æ•°', 'ç¾é‡‘', 'ã‚«ãƒ¼ãƒ‰', 'é›»å­ãƒãƒãƒ¼', 'å£²ä¸Šåˆè¨ˆ', 'äººä»¶è²»', 'äººä»¶è²»%', 'æ”¯æ‰•ã„', 'ç´”å£²ä¸Š', 'TOTALç²—åˆ©', 'å¤©æ°—']);
                    
                    // æ›œæ—¥é…åˆ—
                    const weekDays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
                    
                    // ç´¯è¨ˆç²—åˆ©
                    let totalGrossProfit = 0;
                    
                    // åˆè¨ˆç”¨ã®å¤‰æ•°
                    let sumCustomerCount = 0;
                    let sumCashSales = 0;
                    let sumCreditSales = 0;
                    let sumEmoneSales = 0;
                    let sumTotalSales = 0;
                    let sumLaborCost = 0;
                    let sumPayment = 0;
                    let sumNetSales = 0;
                    
                    // å„æ—¥ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆ1æ—¥ã‹ã‚‰é¸æŠã—ãŸæ—¥ã¾ã§ï¼‰
                    for (let day = 1; day <= endDay; day++) {
                        const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const date = new Date(year, month - 1, day);
                        const weekDay = weekDays[date.getDay()];
                        
                        const data = salesByDate[dateStr];
                        
                        if (data) {
                            // ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆ
                            const customerCount = data.customerCount || 0;
                            const cashSales = data.cashSales || 0;
                            const creditSales = data.creditSales || 0;
                            const emoneSales = data.emoneSales || 0;
                            const totalSales = cashSales + creditSales + emoneSales;
                            
                            // äººä»¶è²»ã‚’attendanceã‹ã‚‰å–å¾—
                            let laborCost = 0;
                            try {
                                const attendanceRef = collection(window.db, 'stores', selectedStore.id, 'attendance');
                                const attendanceSnapshot = await getDocs(attendanceRef);
                                attendanceSnapshot.forEach(docData => {
                                    const attData = docData.data();
                                    if (attData.date === dateStr && attData.totalWage) {
                                        laborCost += attData.totalWage;
                                    }
                                });
                            } catch (e) {
                                console.error('äººä»¶è²»å–å¾—ã‚¨ãƒ©ãƒ¼:', e);
                            }
                            
                            const laborCostPercent = totalSales > 0 ? Math.round(laborCost / totalSales * 100) : 0;
                            
                            // æ”¯å‡ºã‚’expensesã‹ã‚‰å–å¾—
                            let payment = 0;
                            try {
                                const expenseRef = doc(window.db, 'stores', selectedStore.id, 'expenses', dateStr);
                                const expenseDoc = await getDoc(expenseRef);
                                if (expenseDoc.exists()) {
                                    payment = expenseDoc.data().total || 0;
                                }
                            } catch (e) {
                                console.error('æ”¯å‡ºå–å¾—ã‚¨ãƒ©ãƒ¼:', e);
                            }
                            
                            // ç´”å£²ä¸Š
                            const netSales = totalSales - laborCost - payment;
                            
                            // ç´¯è¨ˆç²—åˆ©
                            totalGrossProfit += netSales;
                            
                            // åˆè¨ˆã«åŠ ç®—
                            sumCustomerCount += customerCount;
                            sumCashSales += cashSales;
                            sumCreditSales += creditSales;
                            sumEmoneSales += emoneSales;
                            sumTotalSales += totalSales;
                            sumLaborCost += laborCost;
                            sumPayment += payment;
                            sumNetSales += netSales;
                            
                            excelData.push([
                                '',
                                day,
                                weekDay,
                                customerCount,
                                cashSales,
                                creditSales,
                                emoneSales,
                                totalSales,
                                Math.round(laborCost),
                                laborCostPercent + '%',
                                payment,
                                Math.round(netSales),
                                Math.round(totalGrossProfit),
                                ''
                            ]);
                        } else {
                            // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆï¼ˆç©ºè¡Œï¼‰
                            excelData.push([
                                '',
                                day,
                                weekDay,
                                '', '', '', '', '', '', '', '', '', '', ''
                            ]);
                        }
                    }
                    
                    // åˆè¨ˆè¡Œã‚’è¿½åŠ 
                    const avgLaborCostPercent = sumTotalSales > 0 ? Math.round(sumLaborCost / sumTotalSales * 100) : 0;
                    excelData.push([
                        '',
                        '',
                        'åˆè¨ˆ',
                        sumCustomerCount,
                        sumCashSales,
                        sumCreditSales,
                        sumEmoneSales,
                        sumTotalSales,
                        Math.round(sumLaborCost),
                        avgLaborCostPercent + '%',
                        sumPayment,
                        Math.round(sumNetSales),
                        '',
                        ''
                    ]);
                    
                    console.log('Excelãƒ‡ãƒ¼ã‚¿ä½œæˆå®Œäº†:', excelData.length, 'è¡Œ');
                    
                    // SheetJSã§Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.aoa_to_sheet(excelData);
                    
                    // åˆ—å¹…ã‚’è¨­å®š
                    ws['!cols'] = [
                        { wch: 3 },  // Aåˆ—
                        { wch: 12 }, // Båˆ—ï¼ˆæ—¥ï¼‰
                        { wch: 5 },  // Cåˆ—ï¼ˆæ›œæ—¥ï¼‰
                        { wch: 8 },  // Dåˆ—ï¼ˆä¼ç¥¨æ•°ï¼‰
                        { wch: 10 }, // Eåˆ—ï¼ˆç¾é‡‘ï¼‰
                        { wch: 10 }, // Fåˆ—ï¼ˆã‚«ãƒ¼ãƒ‰ï¼‰
                        { wch: 12 }, // Gåˆ—ï¼ˆé›»å­ãƒãƒãƒ¼ï¼‰
                        { wch: 12 }, // Håˆ—ï¼ˆå£²ä¸Šåˆè¨ˆï¼‰
                        { wch: 10 }, // Iåˆ—ï¼ˆäººä»¶è²»ï¼‰
                        { wch: 8 },  // Jåˆ—ï¼ˆäººä»¶è²»%ï¼‰
                        { wch: 10 }, // Kåˆ—ï¼ˆæ”¯æ‰•ã„ï¼‰
                        { wch: 10 }, // Låˆ—ï¼ˆç´”å£²ä¸Šï¼‰
                        { wch: 12 }, // Måˆ—ï¼ˆTOTALç²—åˆ©ï¼‰
                        { wch: 8 }   // Nåˆ—ï¼ˆå¤©æ°—ï¼‰
                    ];
                    
                    // ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š
                    const range = XLSX.utils.decode_range(ws['!ref']);
                    
                    for (let R = range.s.r; R <= range.e.r; R++) {
                        for (let C = range.s.c; C <= range.e.c; C++) {
                            const cellAddress = XLSX.utils.encode_cell({ r: R, c: C });
                            
                            // ã‚»ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ
                            if (!ws[cellAddress]) {
                                ws[cellAddress] = { t: 's', v: '' };
                            }
                            
                            // ã‚¹ã‚¿ã‚¤ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–
                            if (!ws[cellAddress].s) {
                                ws[cellAddress].s = {};
                            }
                            
                            // ç½«ç·šã‚’è¨­å®š
                            ws[cellAddress].s.border = {
                                top: { style: 'thin', color: { rgb: '000000' } },
                                bottom: { style: 'thin', color: { rgb: '000000' } },
                                left: { style: 'thin', color: { rgb: '000000' } },
                                right: { style: 'thin', color: { rgb: '000000' } }
                            };
                            
                            // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œï¼ˆ5è¡Œç›® = R=4ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ«
                            if (R === 4) {
                                ws[cellAddress].s.fill = {
                                    patternType: 'solid',
                                    fgColor: { rgb: 'D3D3D3' }
                                };
                                ws[cellAddress].s.font = {
                                    bold: true,
                                    sz: 11
                                };
                                ws[cellAddress].s.alignment = {
                                    horizontal: 'center',
                                    vertical: 'center'
                                };
                            }
                            
                            // åˆè¨ˆè¡Œï¼ˆæœ€çµ‚è¡Œï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ«
                            if (R === range.e.r) {
                                ws[cellAddress].s.fill = {
                                    patternType: 'solid',
                                    fgColor: { rgb: 'FFFFCC' }
                                };
                                ws[cellAddress].s.font = {
                                    bold: true,
                                    sz: 11
                                };
                            }
                            
                            // æ•°å€¤ã‚»ãƒ«ã®å³å¯„ã›
                            if (C >= 3 && C <= 12 && R >= 5) {
                                if (!ws[cellAddress].s.alignment) {
                                    ws[cellAddress].s.alignment = {};
                                }
                                ws[cellAddress].s.alignment.horizontal = 'right';
                            }
                        }
                    }
                    
                    XLSX.utils.book_append_sheet(wb, ws, 'å£²ä¸Šæ—¥è¨ˆè¡¨');
                    
                    const fileName = `${selectedStore.storeName}_æ—¥è¨ˆè¡¨_${year}å¹´${month}æœˆ1æ—¥ã€œ${endDay}æ—¥.xlsx`;
                    XLSX.writeFile(wb, fileName);
                    
                    showAlert('success', 'å®Œäº†', `æ—¥è¨ˆè¡¨ã‚’å‡ºåŠ›ã—ã¾ã—ãŸ\n${fileName}`);
                    closeDailyReportModal();
                    
                } catch (error) {
                    console.error('æ—¥è¨ˆè¡¨ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                    showAlert('error', 'ã‚¨ãƒ©ãƒ¼', 'æ—¥è¨ˆè¡¨ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            };
            
            // ç·¨é›†é–‹å§‹
            const startEdit = (store) => {
                setEditingStore(store);
                setFormData({
                    storeName: store.storeName,
                    storePassword: store.storePassword,
                    isActive: store.isActive
                });
            };

            // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                            <div className="text-center mb-8">
                                <div className="bg-purple-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <svg className="w-10 h-10 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                    </svg>
                                </div>
                                <h1 className="text-3xl font-bold text-gray-800">ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†ç”»é¢</h1>
                                <p className="text-gray-500 mt-2">åº—èˆ—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†</p>
                            </div>
                            
                            <form onSubmit={handleLogin}>
                                <div className="mb-6">
                                    <label className="block text-gray-700 text-sm font-bold mb-2">
                                        ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
                                    </label>
                                    <input
                                        type="password"
                                        value={passwordInput}
                                        onChange={(e) => setPasswordInput(e.target.value)}
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-500"
                                        placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
                                        autoFocus
                                    />
                                </div>
                                
                                <button
                                    type="submit"
                                    className="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-bold hover:opacity-90 transition-all"
                                >
                                    ãƒ­ã‚°ã‚¤ãƒ³
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            // ãƒ¡ã‚¤ãƒ³ç”»é¢
            return (
                <div className="min-h-screen bg-gray-100 p-6">
                    <div className="max-w-7xl mx-auto">
                        {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-800">åº—èˆ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
                                    <p className="text-gray-500 mt-1">ç™»éŒ²åº—èˆ—æ•°: {stores.length}</p>
                                </div>
                                <button
                                    onClick={() => setShowAddStore(true)}
                                    className="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-lg font-bold hover:opacity-90 transition-all flex items-center gap-2"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                    </svg>
                                    æ–°è¦åº—èˆ—è¿½åŠ 
                                </button>
                            </div>
                        </div>

                        {/* åº—èˆ—ä¸€è¦§ */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {stores.map((store) => (
                                <div key={store.id} className="bg-white rounded-xl shadow-lg p-6">
                                    <div className="flex items-start justify-between mb-4">
                                        <div className="flex-1">
                                            <h3 className="text-xl font-bold text-gray-800">{store.storeName}</h3>
                                            <p className="text-sm text-gray-500 mt-1">ID: {store.id}</p>
                                        </div>
                                        <div className={`px-3 py-1 rounded-full text-sm font-bold ${store.isActive ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                            {store.isActive ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}
                                        </div>
                                    </div>

                                    <div className="mb-4 p-3 bg-gray-50 rounded-lg">
                                        <div className="flex items-center justify-between mb-1">
                                            <p className="text-sm text-gray-600">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</p>
                                            <button
                                                onClick={() => {
                                                    navigator.clipboard.writeText(store.storePassword);
                                                    showAlert('success', 'ã‚³ãƒ”ãƒ¼å®Œäº†', `${store.storeName}ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ`);
                                                }}
                                                className="text-blue-500 hover:text-blue-700 transition-colors"
                                                title="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼"
                                            >
                                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                                </svg>
                                            </button>
                                        </div>
                                        <p className="font-mono font-bold text-gray-800 break-all">{store.storePassword}</p>
                                    </div>

                                    <div className="flex gap-2 mb-2">
                                        <button
                                            onClick={() => openDailyReportModal(store)}
                                            className="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-2 rounded-lg font-bold hover:opacity-90 transition-all"
                                        >
                                            ğŸ“Š æ—¥è¨ˆè¡¨
                                        </button>
                                    </div>

                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => toggleStoreActive(store.id, store.isActive)}
                                            className={`flex-1 py-2 rounded-lg font-bold transition-all ${store.isActive ? 'bg-yellow-500 text-white hover:bg-yellow-600' : 'bg-green-500 text-white hover:bg-green-600'}`}
                                        >
                                            {store.isActive ? 'ç„¡åŠ¹åŒ–' : 'æœ‰åŠ¹åŒ–'}
                                        </button>
                                        <button
                                            onClick={() => startEdit(store)}
                                            className="flex-1 bg-blue-500 text-white py-2 rounded-lg font-bold hover:bg-blue-600 transition-all"
                                        >
                                            ç·¨é›†
                                        </button>
                                        <button
                                            onClick={() => handleDeleteStore(store.id, store.storeName)}
                                            className="flex-1 bg-red-500 text-white py-2 rounded-lg font-bold hover:bg-red-600 transition-all"
                                        >
                                            å‰Šé™¤
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* æ–°è¦è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                        {showAddStore && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-6">æ–°è¦åº—èˆ—è¿½åŠ </h2>
                                    
                                    <form onSubmit={handleAddStore}>
                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">
                                                åº—èˆ—å *
                                            </label>
                                            <input
                                                type="text"
                                                value={formData.storeName}
                                                onChange={(e) => setFormData({...formData, storeName: e.target.value})}
                                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                                placeholder="ä¾‹: ä¸‹èµ¤å¡šåº—"
                                                required
                                            />
                                        </div>

                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">
                                                ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ *
                                            </label>
                                            <div className="relative">
                                                <input
                                                    type="text"
                                                    value={formData.storePassword}
                                                    onChange={(e) => setFormData({...formData, storePassword: e.target.value})}
                                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 font-mono"
                                                    placeholder="åº—èˆ—ç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                                                    required
                                                />
                                            </div>
                                            <div className="flex gap-2 mt-2">
                                                <button
                                                    type="button"
                                                    onClick={() => {
                                                        const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%^&*';
                                                        let password = '';
                                                        for (let i = 0; i < 16; i++) {
                                                            password += chars.charAt(Math.floor(Math.random() * chars.length));
                                                        }
                                                        setFormData({...formData, storePassword: password});
                                                        showAlert('success', 'ç”Ÿæˆå®Œäº†', 'å®‰å…¨ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸ');
                                                    }}
                                                    className="flex-1 bg-gradient-to-r from-purple-500 to-purple-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:opacity-90 transition-all flex items-center justify-center gap-2"
                                                >
                                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                                    </svg>
                                                    ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => {
                                                        if (formData.storePassword) {
                                                            navigator.clipboard.writeText(formData.storePassword);
                                                            showAlert('success', 'ã‚³ãƒ”ãƒ¼å®Œäº†', 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
                                                        } else {
                                                            showAlert('warning', 'ã‚¨ãƒ©ãƒ¼', 'ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“');
                                                        }
                                                    }}
                                                    className="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:opacity-90 transition-all flex items-center justify-center gap-2"
                                                >
                                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                                    </svg>
                                                    ã‚³ãƒ”ãƒ¼
                                                </button>
                                            </div>
                                            <p className="text-xs text-gray-500 mt-2">
                                                ğŸ’¡ å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã§ãã¾ã™ï¼ˆ16æ–‡å­—ã€å¤§å°è‹±æ•°å­—+è¨˜å·ï¼‰
                                            </p>
                                        </div>

                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-3">
                                                ä½œæˆãƒ¢ãƒ¼ãƒ‰ *
                                            </label>
                                            <div className="space-y-2">
                                                <label className="flex items-center p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-all">
                                                    <input
                                                        type="radio"
                                                        name="createMode"
                                                        value="new"
                                                        checked={formData.createMode === 'new'}
                                                        onChange={(e) => setFormData({...formData, createMode: e.target.value, sourceStoreId: ''})}
                                                        className="w-4 h-4 text-blue-600"
                                                    />
                                                    <div className="ml-3">
                                                        <span className="font-bold text-gray-700">æ–°è¦ä½œæˆ</span>
                                                        <p className="text-sm text-gray-500">ç™½ç´™ã®çŠ¶æ…‹ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ</p>
                                                    </div>
                                                </label>
                                                
                                                <label className="flex items-center p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-all">
                                                    <input
                                                        type="radio"
                                                        name="createMode"
                                                        value="copy"
                                                        checked={formData.createMode === 'copy'}
                                                        onChange={(e) => setFormData({...formData, createMode: e.target.value})}
                                                        className="w-4 h-4 text-blue-600"
                                                    />
                                                    <div className="ml-3">
                                                        <span className="font-bold text-gray-700">ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ”ãƒ¼</span>
                                                        <p className="text-sm text-gray-500">æ—¢å­˜åº—èˆ—ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼</p>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>

                                        {formData.createMode === 'copy' && (
                                            <div className="mb-4">
                                                <label className="block text-gray-700 text-sm font-bold mb-2">
                                                    ã‚³ãƒ”ãƒ¼å…ƒã®åº—èˆ— *
                                                </label>
                                                <select
                                                    value={formData.sourceStoreId}
                                                    onChange={(e) => setFormData({...formData, sourceStoreId: e.target.value})}
                                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                                    required={formData.createMode === 'copy'}
                                                >
                                                    <option value="">åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                                                    {stores.filter(s => s.isActive).map(store => (
                                                        <option key={store.id} value={store.id}>
                                                            {store.storeName}
                                                        </option>
                                                    ))}
                                                </select>
                                                <p className="text-xs text-gray-500 mt-2">
                                                    âš ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã¿ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã™ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«è¨­å®šã¯ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã›ã‚“ï¼‰
                                                </p>
                                            </div>
                                        )}

                                        <div className="mb-6">
                                            <label className="flex items-center">
                                                <input
                                                    type="checkbox"
                                                    checked={formData.isActive}
                                                    onChange={(e) => setFormData({...formData, isActive: e.target.checked})}
                                                    className="w-5 h-5 text-blue-600"
                                                />
                                                <span className="ml-2 text-gray-700">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹</span>
                                            </label>
                                        </div>

                                        <div className="flex gap-3">
                                            <button
                                                type="button"
                                                onClick={() => {
                                                    setShowAddStore(false);
                                                    setFormData({ 
                                                        storeName: '', 
                                                        storePassword: '', 
                                                        isActive: true,
                                                        createMode: 'new',
                                                        sourceStoreId: ''
                                                    });
                                                }}
                                                className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400 transition-all"
                                            >
                                                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                            </button>
                                            <button
                                                type="submit"
                                                className="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-bold hover:opacity-90 transition-all"
                                            >
                                                è¿½åŠ 
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        )}

                        {/* ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                        {editingStore && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-6">åº—èˆ—æƒ…å ±ç·¨é›†</h2>
                                    
                                    <form onSubmit={handleEditStore}>
                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">
                                                åº—èˆ—å *
                                            </label>
                                            <input
                                                type="text"
                                                value={formData.storeName}
                                                onChange={(e) => setFormData({...formData, storeName: e.target.value})}
                                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                                required
                                            />
                                        </div>

                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">
                                                ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ *
                                            </label>
                                            <div className="relative">
                                                <input
                                                    type="text"
                                                    value={formData.storePassword}
                                                    onChange={(e) => setFormData({...formData, storePassword: e.target.value})}
                                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 font-mono"
                                                    required
                                                />
                                            </div>
                                            <div className="flex gap-2 mt-2">
                                                <button
                                                    type="button"
                                                    onClick={() => {
                                                        const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%^&*';
                                                        let password = '';
                                                        for (let i = 0; i < 16; i++) {
                                                            password += chars.charAt(Math.floor(Math.random() * chars.length));
                                                        }
                                                        setFormData({...formData, storePassword: password});
                                                        showAlert('success', 'ç”Ÿæˆå®Œäº†', 'å®‰å…¨ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸ');
                                                    }}
                                                    className="flex-1 bg-gradient-to-r from-purple-500 to-purple-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:opacity-90 transition-all flex items-center justify-center gap-2"
                                                >
                                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                                    </svg>
                                                    ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => {
                                                        if (formData.storePassword) {
                                                            navigator.clipboard.writeText(formData.storePassword);
                                                            showAlert('success', 'ã‚³ãƒ”ãƒ¼å®Œäº†', 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
                                                        } else {
                                                            showAlert('warning', 'ã‚¨ãƒ©ãƒ¼', 'ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“');
                                                        }
                                                    }}
                                                    className="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:opacity-90 transition-all flex items-center justify-center gap-2"
                                                >
                                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                                    </svg>
                                                    ã‚³ãƒ”ãƒ¼
                                                </button>
                                            </div>
                                        </div>

                                        <div className="mb-6">
                                            <label className="flex items-center">
                                                <input
                                                    type="checkbox"
                                                    checked={formData.isActive}
                                                    onChange={(e) => setFormData({...formData, isActive: e.target.checked})}
                                                    className="w-5 h-5 text-blue-600"
                                                />
                                                <span className="ml-2 text-gray-700">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹</span>
                                            </label>
                                        </div>

                                        {/* ğŸ†• ä»–åº—èˆ—ã‹ã‚‰ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ */}
                                        <div className="mb-4 pb-4 border-b border-gray-200">
                                            <button
                                                type="button"
                                                onClick={() => setShowCopyDialog(true)}
                                                className="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:opacity-90 transition-all flex items-center justify-center gap-2"
                                            >
                                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                                </svg>
                                                ä»–åº—èˆ—ã‹ã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼
                                            </button>
                                        </div>

                                        <div className="flex gap-3">
                                            <button
                                                type="button"
                                                onClick={() => {
                                                    setEditingStore(null);
                                                    setFormData({ 
                                                        storeName: '', 
                                                        storePassword: '', 
                                                        isActive: true,
                                                        createMode: 'new',
                                                        sourceStoreId: ''
                                                    });
                                                }}
                                                className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400 transition-all"
                                            >
                                                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                            </button>
                                            <button
                                                type="submit"
                                                className="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-bold hover:opacity-90 transition-all"
                                            >
                                                æ›´æ–°
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        )}

                        {/* ğŸ†• ã‚³ãƒ”ãƒ¼å…ƒé¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚° */}
                        {showCopyDialog && (
                            <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-[60]">
                                <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-6">ã‚³ãƒ”ãƒ¼å…ƒã®åº—èˆ—ã‚’é¸æŠ</h2>
                                    
                                    <div className="space-y-2 mb-6 max-h-96 overflow-y-auto">
                                        {/* ä¸‹èµ¤å¡š */}
                                        <button
                                            onClick={async () => {
                                                setShowCopyDialog(false);
                                                await handleCopyFromStore('');
                                            }}
                                            className="w-full text-left px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all"
                                        >
                                            <div className="font-bold text-gray-800">ä¸‹èµ¤å¡š</div>
                                            <div className="text-sm text-gray-600">ãƒ«ãƒ¼ãƒˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</div>
                                        </button>
                                        
                                        {/* ä»–ã®åº—èˆ— */}
                                        {stores.filter(s => editingStore && s.id !== editingStore.id && s.id !== 'shimoakatsuka').map(store => (
                                            <button
                                                key={store.id}
                                                onClick={async () => {
                                                    setShowCopyDialog(false);
                                                    await handleCopyFromStore(store.id);
                                                }}
                                                className="w-full text-left px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all"
                                            >
                                                <div className="font-bold text-gray-800">{store.storeName}</div>
                                                <div className="text-sm text-gray-600">ID: {store.id}</div>
                                            </button>
                                        ))}
                                    </div>
                                    
                                    <button
                                        onClick={() => setShowCopyDialog(false)}
                                        className="w-full bg-gray-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-gray-600 transition-all"
                                    >
                                        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                    <CustomModal
                        isOpen={modal.isOpen}
                        onClose={() => setModal({ ...modal, isOpen: false })}
                        type={modal.type}
                        title={modal.title}
                        message={modal.message}
                    />
                    
                    {/* ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« */}
                    <ConfirmModal
                        isOpen={confirmModal.isOpen}
                        onClose={() => setConfirmModal({ ...confirmModal, isOpen: false })}
                        onConfirm={confirmModal.onConfirm}
                        title={confirmModal.title}
                        message={confirmModal.message}
                    />
                    
                    {/* æ—¥è¨ˆè¡¨å‡ºåŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                    {showDailyReportModal && selectedStore && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">ğŸ“Š æ—¥è¨ˆè¡¨å‡ºåŠ›</h2>
                                
                                <div className="mb-6">
                                    <p className="text-gray-700 mb-4">
                                        <span className="font-bold text-lg">{selectedStore.storeName}</span>
                                    </p>
                                    <p className="text-sm text-gray-600 mb-2">å‡ºåŠ›ã™ã‚‹æœˆã¨æœ€çµ‚æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                                    <p className="text-xs text-blue-600 mb-4">â€» 1æ—¥ã‹ã‚‰é¸æŠã—ãŸæ—¥ã¾ã§ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã—ã¾ã™</p>
                                    
                                    <div className="grid grid-cols-3 gap-3">
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-2">å¹´</label>
                                            <select
                                                value={reportYear}
                                                onChange={(e) => setReportYear(parseInt(e.target.value))}
                                                className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                            >
                                                {[...Array(5)].map((_, i) => {
                                                    const year = new Date().getFullYear() - i;
                                                    return <option key={year} value={year}>{year}å¹´</option>;
                                                })}
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-2">æœˆ</label>
                                            <select
                                                value={reportMonth}
                                                onChange={(e) => setReportMonth(parseInt(e.target.value))}
                                                className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                            >
                                                {[...Array(12)].map((_, i) => (
                                                    <option key={i + 1} value={i + 1}>{i + 1}æœˆ</option>
                                                ))}
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-2">æ—¥</label>
                                            <select
                                                value={reportDay}
                                                onChange={(e) => setReportDay(parseInt(e.target.value))}
                                                className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                            >
                                                {[...Array(31)].map((_, i) => (
                                                    <option key={i + 1} value={i + 1}>{i + 1}æ—¥</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="flex gap-3">
                                    <button
                                        onClick={closeDailyReportModal}
                                        className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400 transition-all"
                                    >
                                        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                    </button>
                                    <button
                                        onClick={generateDailyReport}
                                        className="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-lg font-bold hover:opacity-90 transition-all"
                                    >
                                        å‡ºåŠ›
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<SuperAdminSystem />, document.getElementById('root'));
    </script>
</body>
</html>
