<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<title>ç²‰ã‚‚ã‚“å±‹ å…« ä¸‹èµ¤å¡šåº—</title>
<style>
/* ç”»åƒã‚’ç”»é¢å¹…ã«åˆã‚ã›ã¦ç¸®å°ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ */
img {
    max-width: 100%; 
    height: auto;
    display: block;
}

/* å…¨ä½“ã‚’ä¸­å¤®æƒãˆã«ã—ã€ä½™åº¦ãªä½™ç™½ã‚’ãªãã™ */
body {
    margin: 0;
    padding: 0 0 100px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.content-area {
    width: 90%;
    max-width: 420px;
    margin-top: 80px;
    text-align: center;
}

.container {
    max-width: 600px;
    height: auto;
    margin: 0 auto;
}

.top-image, .bottom-image {
    width: 100%;
    height: auto;
    display: block;
}

.content-area {
    background-color: #FFFF00;
    padding: 30px 330px;
}

.welcome-text {
    font-size: 2em;
    font-weight: bold;
    color: #333;
    margin-bottom: 20px;
}

.start-button {
    display: inline-block;
    background-color: #C0C0C0;
    color: white;
    padding: 15px 40px;
    text-decoration: none;
    border-radius: 5px;
    font-size: 1.2em;
    font-weight: bold;
    box-shadow: 0 4px #cc5200;
}

.start-button:active {
    box-shadow: 0 1px #cc5200;
    transform: translateY(3px);
}
</style>
</head>
<body>
<div class="container" align="center">
    <img src="main.jpg" class="top-image" width="600" height="300" alt="ç²‰ã‚‚ã‚“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸">
    <img src="irassyaimase.jpg" width="600" height="204" usemap="#irassyaimase" alt="ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›">
    <button onclick="startOrder();" style="border:none;background:none;padding:0;cursor:pointer;">
      <img src="botan.jpg" width="250" height="80" alt="æ³¨æ–‡é–‹å§‹" style="display:block;">
    </button>
    <img src="tyuumonnkaisi.jpg" width="600" height="201" alt="æ³¨æ–‡é–‹å§‹">
</div>

<!-- å‘¼ã³å‡ºã—ã¨ãŠä¼šè¨ˆãƒœã‚¿ãƒ³ -->
<div style="position: fixed; bottom: 20px; left: 20px; right: 20px; z-index: 1000; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 600px; margin: 0 auto;">
  <button style="padding: 18px; font-size: 20px; font-weight: bold; border: none; border-radius: 12px; cursor: pointer; background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); color: white; box-shadow: 0 8px 20px rgba(0,0,0,0.3);" onclick="callStaff()"> å‘¼å‡º</button>
  <button style="padding: 18px; font-size: 20px; font-weight: bold; border: none; border-radius: 12px; cursor: pointer; background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); color: white; box-shadow: 0 8px 20px rgba(0,0,0,0.3);" onclick="requestBill()"> ãŠä¼šè¨ˆ</button>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getFirestore, collection, addDoc, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

const firebaseConfig = {
  apiKey: "AIzaSyBoSdfEkez-b3P0BUHtowxCrTw-yEBdHSg",
  authDomain: "takoyaki-order-system-bacd7.firebaseapp.com",
  projectId: "takoyaki-order-system-bacd7",
  storageBucket: "takoyaki-order-system-bacd7.firebasestorage.app",
  messagingSenderId: "104494752890",
  appId: "1:104494752890:web:c0a25d62f42ffca01687c3"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ğŸ†• URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰storeã¨tableã‚’å–å¾—
const urlParams = new URLSearchParams(window.location.search);
const storeId = urlParams.get('store');
const tableNumber = urlParams.get('table') || 'ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆ';

console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
console.log('ğŸ“ index.html åˆæœŸåŒ–');
console.log('   åº—èˆ—ID:', storeId);
console.log('   ãƒ†ãƒ¼ãƒ–ãƒ«:', tableNumber);
console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

// ğŸ†• åº—èˆ—åˆ¥ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å‚ç…§ã‚’å–å¾—
window.getStoreCollection = function(collectionName) {
  if (!storeId || storeId === 'shimoakatsuka') {
    // ä¸‹èµ¤å¡šåº—ï¼ˆæ—§ã‚·ã‚¹ãƒ†ãƒ ï¼‰
    return collection(db, collectionName);
  }
  // æ–°åº—èˆ—
  return collection(db, "stores", storeId, collectionName);
};

// ğŸ†• åº—èˆ—ç”»åƒã‚’èª­ã¿è¾¼ã‚€
async function loadStoreImages() {
  if (!storeId || storeId === 'shimoakatsuka') {
    console.log('   ä¸‹èµ¤å¡šåº—: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒã‚’ä½¿ç”¨');
    return; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒã‚’ä½¿ç”¨
  }
  
  try {
    const { getDoc, doc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
    const storeDoc = await getDoc(doc(db, 'stores', storeId));
    
    if (storeDoc.exists()) {
      const storeData = storeDoc.data();
      console.log('   åº—èˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—:', storeData.storeName);
      
      // çœ‹æ¿ç”»åƒ
      if (storeData.mainImageUrl) {
        const mainImg = document.querySelector('.top-image');
        if (mainImg) {
          mainImg.src = storeData.mainImageUrl;
          console.log('   âœ… çœ‹æ¿ç”»åƒã‚’è¨­å®š');
        }
      }
      
      // ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ç”»åƒ
      if (storeData.welcomeImageUrl) {
        const welcomeImg = document.querySelector('img[alt="ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›"]');
        if (welcomeImg) {
          welcomeImg.src = storeData.welcomeImageUrl;
          console.log('   âœ… ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ç”»åƒã‚’è¨­å®š');
        }
      }
      
      // ãƒœã‚¿ãƒ³ç”»åƒ
      if (storeData.buttonImageUrl) {
        const buttonImg = document.querySelector('img[alt="æ³¨æ–‡é–‹å§‹"]');
        if (buttonImg) {
          buttonImg.src = storeData.buttonImageUrl;
          console.log('   âœ… ãƒœã‚¿ãƒ³ç”»åƒã‚’è¨­å®š');
        }
      }
      
      console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    }
  } catch (error) {
    console.error('   ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
  }
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ç”»åƒã‚’è¨­å®š
window.addEventListener('DOMContentLoaded', loadStoreImages);

// ğŸ†• æ³¨æ–‡é–‹å§‹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã®å‡¦ç†
function startOrder() {
  console.log('ğŸš€ æ³¨æ–‡é–‹å§‹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯');
  
  let menuUrl = 'menu.html';
  const params = new URLSearchParams();
  
  // storeãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¼•ãç¶™ãï¼ˆæœ€é‡è¦ï¼ï¼‰
  if (storeId) {
    params.append('store', storeId);
    console.log('   åº—èˆ—IDã‚’å¼•ãç¶™ã:', storeId);
  }
  
  // tableãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¼•ãç¶™ã
  if (urlParams.get('table')) {
    params.append('table', tableNumber);
    console.log('   ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å¼•ãç¶™ã:', tableNumber);
  }
  
  // fromIndexãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
  params.append('fromIndex', '1');
  
  const finalUrl = menuUrl + '?' + params.toString();
  console.log('   ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆ:', finalUrl);
  console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
  
  window.location.href = finalUrl;
}

// ğŸ†• å‘¼ã³å‡ºã—ãƒœã‚¿ãƒ³ï¼ˆåº—èˆ—åˆ¥å¯¾å¿œï¼‰
window.callStaff = async function() {
  try {
    const callData = {
      tableNumber: tableNumber,
      timestamp: Timestamp.now(),
      type: 'call'
    };
    
    // åº—èˆ—åˆ¥ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ä¿å­˜
    await addDoc(window.getStoreCollection('staff_calls'), callData);
    
    showCustomAlert('åº—å“¡ã‚’å‘¼ã³ã¾ã—ãŸ!');
    console.log('ğŸ“ åº—å“¡å‘¼ã³å‡ºã—å®Œäº† - ãƒ†ãƒ¼ãƒ–ãƒ«:', tableNumber, 'åº—èˆ—:', storeId || 'ä¸‹èµ¤å¡š');
  } catch (e) {
    console.error('å‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼:', e);
    showCustomAlert('å‘¼ã³å‡ºã—ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
};

// ğŸ†• ãŠä¼šè¨ˆãƒœã‚¿ãƒ³ï¼ˆåº—èˆ—åˆ¥å¯¾å¿œï¼‰
window.requestBill = async function() {
  try {
    const billData = {
      tableNumber: tableNumber,
      timestamp: Timestamp.now(),
      type: 'bill'
    };
    
    // åº—èˆ—åˆ¥ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ä¿å­˜
    await addDoc(window.getStoreCollection('staff_calls'), billData);
    
    showCustomAlert('ãŠä¼šè¨ˆã§ã™ã€‚');
    console.log('ğŸ’µ ãŠä¼šè¨ˆå‘¼ã³å‡ºã—å®Œäº† - ãƒ†ãƒ¼ãƒ–ãƒ«:', tableNumber, 'åº—èˆ—:', storeId || 'ä¸‹èµ¤å¡š');
  } catch (e) {
    console.error('ãŠä¼šè¨ˆã‚¨ãƒ©ãƒ¼:', e);
    showCustomAlert('ãŠä¼šè¨ˆå‘¼ã³å‡ºã—ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
};

// ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
function showCustomAlert(message) {
  const overlay = document.createElement('div');
  overlay.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
  `;
  
  const dialog = document.createElement('div');
  dialog.style.cssText = `
    background: white;
    border-radius: 15px;
    padding: 30px;
    max-width: 80%;
    text-align: center;
    box-shadow: 0 8px 30px rgba(0,0,0,0.3);
  `;
  
  const text = document.createElement('div');
  text.textContent = message;
  text.style.cssText = `
    font-size: 18px;
    margin-bottom: 20px;
    color: #333;
    white-space: pre-line;
  `;
  
  const button = document.createElement('button');
  button.textContent = 'OK';
  button.style.cssText = `
    padding: 12px 40px;
    background: #2196F3;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
  `;
  button.onclick = () => overlay.remove();
  
  dialog.appendChild(text);
  dialog.appendChild(button);
  overlay.appendChild(dialog);
  document.body.appendChild(overlay);
}

window.startOrder = startOrder;
</script>
</body>
</html>
