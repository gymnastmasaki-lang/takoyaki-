<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è©³ç´°çµ¦ä¸è¨ˆç®—</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <!-- FirebaseåˆæœŸåŒ– -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBoSdfEkez-b3P0BUHtowxCrTw-yEBdHSg",
            authDomain: "takoyaki-order-system-bacd7.firebaseapp.com",
            projectId: "takoyaki-order-system-bacd7",
            storageBucket: "takoyaki-order-system-bacd7.firebasestorage.app",
            messagingSenderId: "104494752890",
            appId: "1:104494752890:web:c0a25d62f42ffca01687c3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.FirebaseReady = true;
        window.db = db;
        window.firebaseModules = { collection, getDocs, doc, getDoc };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // åº—èˆ—IDãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆkanri.htmlã¨åŒã˜ï¼‰
        window.currentStoreId = null;
        window.currentStoreName = null;

        window.getStoreCollection = function(collectionName) {
            if (!window.currentStoreId || window.currentStoreId === '' || window.currentStoreId === null) {
                const oldPathMap = {
                    'employees': 'kintai_employees',
                    'attendance': 'kintai_attendance'
                };
                const path = oldPathMap[collectionName] || collectionName;
                return window.firebaseModules.collection(window.db, path);
            }
            return window.firebaseModules.collection(window.db, 'stores', window.currentStoreId, collectionName);
        };

        window.getStoreDoc = function(collectionName, docId) {
            if (!window.currentStoreId || window.currentStoreId === '' || window.currentStoreId === null) {
                const oldPathMap = {
                    'employees': 'kintai_employees',
                    'attendance': 'kintai_attendance'
                };
                const path = oldPathMap[collectionName] || collectionName;
                return window.firebaseModules.doc(window.db, path, docId);
            }
            return window.firebaseModules.doc(window.db, 'stores', window.currentStoreId, collectionName, docId);
        };

        const DetailedSalaryCalculator = () => {
            const [employees, setEmployees] = useState([]);
            const [selectedEmployee, setSelectedEmployee] = useState(null);
            const [currentYear, setCurrentYear] = useState(new Date().getFullYear());
            const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());
            const [attendanceData, setAttendanceData] = useState({});
            
            // å‰å¹´æ‰€å¾—å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
            const [previousYearIncome, setPreviousYearIncome] = useState({
                year: new Date().getFullYear() - 1,
                totalIncome: 0,
                municipality: 'æ±äº¬éƒ½',
                socialInsurance: 0,
                incomeType: 'salary'
            });
            
            // è¨ˆç®—çµæœ
            const [calculationResult, setCalculationResult] = useState(null);
            const [showResult, setShowResult] = useState(false);
            
            // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [storeNameInput, setStoreNameInput] = useState('');
            const [passwordInput, setPasswordInput] = useState('');

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒ
            useEffect(() => {
                const storedStoreId = sessionStorage.getItem('kanriStoreId');
                const storedStoreName = sessionStorage.getItem('kanriStoreName');
                
                if (storedStoreName) {
                    let actualStoreId = null;
                    if (storedStoreId && storedStoreId !== '' && storedStoreId !== 'shimoakatsuka' && storedStoreId !== 'shimoarekasuka') {
                        actualStoreId = storedStoreId;
                    }
                    
                    window.currentStoreId = actualStoreId;
                    window.currentStoreName = storedStoreName;
                    setIsAuthenticated(true);
                }
            }, []);

            // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
            const handleLogin = async (e) => {
                e.preventDefault();
                
                try {
                    const { collection, getDocs } = window.firebaseModules;
                    
                    // ä¸‹èµ¤å¡šåº—ãƒã‚§ãƒƒã‚¯
                    if (storeNameInput === 'ä¸‹èµ¤å¡š' && passwordInput === 'K12290619T') {
                        window.currentStoreId = null;
                        window.currentStoreName = 'ä¸‹èµ¤å¡š';
                        sessionStorage.setItem('kanriStoreId', '');
                        sessionStorage.setItem('kanriStoreName', 'ä¸‹èµ¤å¡š');
                        setIsAuthenticated(true);
                        return;
                    }
                    
                    // ä»–åº—èˆ—ãƒã‚§ãƒƒã‚¯
                    const storesRef = collection(window.db, 'stores');
                    const storesSnapshot = await getDocs(storesRef);
                    
                    let foundStore = null;
                    storesSnapshot.forEach(docSnap => {
                        const data = docSnap.data();
                        if (data.storeName === storeNameInput && data.storePassword === passwordInput) {
                            foundStore = { id: docSnap.id, ...data };
                        }
                    });
                    
                    if (foundStore) {
                        window.currentStoreId = foundStore.id;
                        window.currentStoreName = foundStore.storeName;
                        sessionStorage.setItem('kanriStoreId', foundStore.id);
                        sessionStorage.setItem('kanriStoreName', foundStore.storeName);
                        setIsAuthenticated(true);
                    } else {
                        alert('åº—èˆ—åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                    }
                } catch (error) {
                    console.error('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
                    alert('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            };

            // å¾“æ¥­å“¡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            useEffect(() => {
                if (!isAuthenticated) return;
                
                const loadEmployees = async () => {
                    try {
                        while (!window.FirebaseReady) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                        
                        const { getDocs } = window.firebaseModules;
                        const empRef = window.getStoreCollection('employees');
                        const empSnapshot = await getDocs(empRef);
                        const empList = [];
                        
                        empSnapshot.forEach(docSnap => {
                            empList.push({ id: docSnap.id, ...docSnap.data() });
                        });
                        
                        empList.sort((a, b) => (a.order || 0) - (b.order || 0));
                        setEmployees(empList);
                    } catch (error) {
                        console.error('å¾“æ¥­å“¡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                    }
                };
                
                loadEmployees();
            }, [isAuthenticated]);

            // å‹¤æ€ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            useEffect(() => {
                if (!isAuthenticated || !selectedEmployee) return;
                
                const loadAttendance = async () => {
                    try {
                        const { getDocs } = window.firebaseModules;
                        const attRef = window.getStoreCollection('attendance');
                        const attSnapshot = await getDocs(attRef);
                        
                        const attData = {};
                        attSnapshot.forEach(docSnap => {
                            const docId = docSnap.id;
                            const docData = docSnap.data();
                            
                            const parts = docId.split('_');
                            if (parts.length >= 2) {
                                const employeeId = parts[0];
                                const dateKey = parts.slice(1).join('_');
                                
                                const dateMatch = dateKey.match(/^(\d{4})-(\d{2})-/);
                                if (dateMatch) {
                                    const year = parseInt(dateMatch[1]);
                                    const month = parseInt(dateMatch[2]) - 1;
                                    
                                    if (year === currentYear && month === currentMonth && employeeId === selectedEmployee.id) {
                                        if (!attData[employeeId]) {
                                            attData[employeeId] = {};
                                        }
                                        attData[employeeId][dateKey] = docData;
                                    }
                                }
                            }
                        });
                        
                        setAttendanceData(attData);
                    } catch (error) {
                        console.error('å‹¤æ€ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                    }
                };
                
                loadAttendance();
            }, [isAuthenticated, selectedEmployee, currentYear, currentMonth]);

            // çµ¦ä¸è¨ˆç®—
            const calculateSalary = () => {
                if (!selectedEmployee) {
                    alert('å¾“æ¥­å“¡ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                
                const employee = selectedEmployee;
                const empAttendance = attendanceData[employee.id] || {};
                
                // ç·åŠ´åƒæ™‚é–“ã¨è³ƒé‡‘ã‚’è¨ˆç®—
                let totalHours = 0;
                let totalWage = 0;
                
                Object.keys(empAttendance).forEach(dateKey => {
                    const att = empAttendance[dateKey];
                    if (att.workHours && att.totalWage) {
                        totalHours += att.workHours;
                        totalWage += att.totalWage;
                    }
                });
                
                // å›ºå®šçµ¦ã®å ´åˆ
                if (employee.salaryType === 'fixed' && employee.monthlySalary) {
                    totalWage = employee.monthlySalary;
                }
                
                // æ§é™¤è¨ˆç®—
                const deductions = calculateDetailedDeductions(employee, totalWage, previousYearIncome);
                
                // çµæœã‚’ä¿å­˜
                setCalculationResult({
                    employee,
                    year: currentYear,
                    month: currentMonth,
                    totalHours,
                    totalWage,
                    deductions,
                    netPay: totalWage - deductions.totalDeductions,
                    previousYearIncome
                });
                
                setShowResult(true);
            };

            // è©³ç´°ãªæ§é™¤è¨ˆç®—
            const calculateDetailedDeductions = (employee, totalWage, prevYearData) => {
                const result = {
                    healthInsurance: 0,
                    pension: 0,
                    employmentInsurance: 0,
                    incomeTax: 0,
                    residentTax: 0,
                    rent: employee.deductions?.rent || 0,
                    utilities: employee.deductions?.utilities || 0,
                    totalDeductions: 0,
                    details: {}
                };
                
                // ç¤¾ä¼šä¿é™ºæ–™è¨ˆç®—ï¼ˆkanri.htmlã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
                // ... (çœç•¥ã€å¾Œã§å®Ÿè£…)
                
                // ä½æ°‘ç¨è¨ˆç®—ï¼ˆå‰å¹´ã®æ‰€å¾—ã«åŸºã¥ãï¼‰
                if (prevYearData && prevYearData.totalIncome > 0) {
                    // çµ¦ä¸æ‰€å¾—æ§é™¤
                    let employmentIncomeDeduction = 0;
                    if (prevYearData.incomeType === 'salary') {
                        const income = prevYearData.totalIncome;
                        if (income <= 1625000) {
                            employmentIncomeDeduction = 550000;
                        } else if (income <= 1800000) {
                            employmentIncomeDeduction = Math.floor(income * 0.4 - 100000);
                        } else if (income <= 3600000) {
                            employmentIncomeDeduction = Math.floor(income * 0.3 + 80000);
                        } else if (income <= 6600000) {
                            employmentIncomeDeduction = Math.floor(income * 0.2 + 440000);
                        } else if (income <= 8500000) {
                            employmentIncomeDeduction = Math.floor(income * 0.1 + 1100000);
                        } else {
                            employmentIncomeDeduction = 1950000;
                        }
                    }
                    
                    // çµ¦ä¸æ‰€å¾—
                    const employmentIncome = Math.max(0, prevYearData.totalIncome - employmentIncomeDeduction);
                    
                    // èª²ç¨æ‰€å¾—
                    const socialInsurance = prevYearData.socialInsurance || 0;
                    const baseDeduction = 480000;
                    const taxableIncome = Math.max(0, employmentIncome - socialInsurance - baseDeduction);
                    
                    // å¹´é–“ä½æ°‘ç¨
                    const municipalityEqualTax = {
                        'æ±äº¬éƒ½': 5000, 'å¤§é˜ªåºœ': 5300, 'ç¥å¥ˆå·çœŒ': 5800,
                        'åŸ¼ç‰çœŒ': 5000, 'åƒè‘‰çœŒ': 5000
                    };
                    const equalTax = municipalityEqualTax[prevYearData.municipality] || 5500;
                    const annualResidentTax = Math.floor(taxableIncome * 0.10) + equalTax;
                    
                    // æœˆé¡ä½æ°‘ç¨ï¼ˆ6æœˆã‹ã‚‰12å›æ‰•ã„ï¼‰
                    if (currentMonth >= 5) {
                        result.residentTax = Math.floor(annualResidentTax / 12);
                    } else {
                        result.residentTax = 0;
                    }
                    
                    // è©³ç´°æƒ…å ±ã‚’ä¿å­˜
                    result.details.previousYearIncome = prevYearData.totalIncome;
                    result.details.employmentIncomeDeduction = employmentIncomeDeduction;
                    result.details.employmentIncome = employmentIncome;
                    result.details.socialInsuranceDeduction = socialInsurance;
                    result.details.baseDeduction = baseDeduction;
                    result.details.taxableIncome = taxableIncome;
                    result.details.annualResidentTax = annualResidentTax;
                    result.details.monthlyResidentTax = result.residentTax;
                }
                
                result.totalDeductions = result.healthInsurance + result.pension + result.employmentInsurance + result.incomeTax + result.residentTax + result.rent + result.utilities;
                
                return result;
            };

            // çµ¦ä¸æ˜ç´°å°åˆ·
            const printPayslip = async () => {
                if (!calculationResult) return;
                
                const payslipElement = document.getElementById('payslip-content');
                if (!payslipElement) return;
                
                try {
                    const canvas = await html2canvas(payslipElement, {
                        scale: 2,
                        backgroundColor: '#ffffff'
                    });
                    
                    const link = document.createElement('a');
                    link.download = `çµ¦ä¸æ˜ç´°_${calculationResult.employee.name}_${currentYear}å¹´${currentMonth + 1}æœˆ.png`;
                    link.href = canvas.toDataURL();
                    link.click();
                } catch (error) {
                    console.error('å°åˆ·ã‚¨ãƒ©ãƒ¼:', error);
                    alert('å°åˆ·ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            };

            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                            <h1 className="text-3xl font-bold text-gray-800 mb-6 text-center">è©³ç´°çµ¦ä¸è¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ </h1>
                            <form onSubmit={handleLogin}>
                                <div className="mb-4">
                                    <label className="block text-gray-700 text-sm font-bold mb-2">åº—èˆ—å</label>
                                    <input
                                        type="text"
                                        value={storeNameInput}
                                        onChange={(e) => setStoreNameInput(e.target.value)}
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                        required
                                    />
                                </div>
                                <div className="mb-6">
                                    <label className="block text-gray-700 text-sm font-bold mb-2">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                                    <input
                                        type="password"
                                        value={passwordInput}
                                        onChange={(e) => setPasswordInput(e.target.value)}
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                        required
                                    />
                                </div>
                                <button
                                    type="submit"
                                    className="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-bold"
                                >
                                    ãƒ­ã‚°ã‚¤ãƒ³
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-lg p-6 mb-4">
                            <h1 className="text-3xl font-bold text-gray-800 mb-4">ğŸ“Š è©³ç´°çµ¦ä¸è¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ </h1>
                            <p className="text-gray-600 mb-4">
                                å‰å¹´ã®æ‰€å¾—ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã€æ­£ç¢ºãªä½æ°‘ç¨ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
                            </p>
                            
                            {/* å¾“æ¥­å“¡é¸æŠ */}
                            <div className="mb-6">
                                <label className="block text-gray-700 font-bold mb-2">å¾“æ¥­å“¡ã‚’é¸æŠ</label>
                                <select
                                    value={selectedEmployee?.id || ''}
                                    onChange={(e) => {
                                        const emp = employees.find(e => e.id === e.target.value);
                                        setSelectedEmployee(emp);
                                        setShowResult(false);
                                    }}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                >
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    {employees.map(emp => (
                                        <option key={emp.id} value={emp.id}>{emp.name}</option>
                                    ))}
                                </select>
                            </div>
                            
                            {/* å¯¾è±¡å¹´æœˆ */}
                            <div className="grid grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label className="block text-gray-700 font-bold mb-2">å¯¾è±¡å¹´</label>
                                    <select
                                        value={currentYear}
                                        onChange={(e) => setCurrentYear(parseInt(e.target.value))}
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                    >
                                        {[2026, 2025, 2024, 2023].map(year => (
                                            <option key={year} value={year}>{year}å¹´</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-gray-700 font-bold mb-2">å¯¾è±¡æœˆ</label>
                                    <select
                                        value={currentMonth}
                                        onChange={(e) => setCurrentMonth(parseInt(e.target.value))}
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                    >
                                        {[...Array(12)].map((_, i) => (
                                            <option key={i} value={i}>{i + 1}æœˆ</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            
                            {/* å‰å¹´æ‰€å¾—å…¥åŠ› */}
                            <div className="border-t-2 pt-6 mb-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">å‰å¹´ã®å¹´é–“æ‰€å¾—</h2>
                                
                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label className="block text-gray-700 font-bold mb-2">å¯¾è±¡å¹´</label>
                                        <input
                                            type="number"
                                            value={previousYearIncome.year}
                                            onChange={(e) => setPreviousYearIncome({...previousYearIncome, year: parseInt(e.target.value)})}
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-gray-700 font-bold mb-2">æ‰€å¾—åŒºåˆ†</label>
                                        <select
                                            value={previousYearIncome.incomeType}
                                            onChange={(e) => setPreviousYearIncome({...previousYearIncome, incomeType: e.target.value})}
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                        >
                                            <option value="salary">çµ¦ä¸æ‰€å¾—è€…</option>
                                            <option value="business">äº‹æ¥­æ‰€å¾—è€…</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div className="mb-4">
                                    <label className="block text-gray-700 font-bold mb-2">
                                        å¹´é–“ç·æ”¯çµ¦é¡ï¼ˆæ§é™¤å‰ï¼‰
                                    </label>
                                    <input
                                        type="number"
                                        value={previousYearIncome.totalIncome}
                                        onChange={(e) => setPreviousYearIncome({...previousYearIncome, totalIncome: parseInt(e.target.value) || 0})}
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                        placeholder="ä¾‹: 3000000"
                                    />
                                    <p className="text-sm text-gray-600 mt-1">
                                        â€»çµ¦ä¸æ‰€å¾—è€…: æ¯æœˆã®çµ¦ä¸æ˜ç´°ã®ã€Œç·æ”¯çµ¦é¡ã€ã‚’1å¹´åˆ†åˆè¨ˆ<br/>
                                        â€»äº‹æ¥­æ‰€å¾—è€…: å£²ä¸Š - çµŒè²»ï¼ˆæº–ç²—åˆ©ï¼‰
                                    </p>
                                </div>
                                
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-gray-700 font-bold mb-2">éƒ½é“åºœçœŒ</label>
                                        <select
                                            value={previousYearIncome.municipality}
                                            onChange={(e) => setPreviousYearIncome({...previousYearIncome, municipality: e.target.value})}
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                        >
                                            <option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option>
                                            <option value="å¤§é˜ªåºœ">å¤§é˜ªåºœ</option>
                                            <option value="ç¥å¥ˆå·çœŒ">ç¥å¥ˆå·çœŒ</option>
                                            <option value="åŸ¼ç‰çœŒ">åŸ¼ç‰çœŒ</option>
                                            <option value="åƒè‘‰çœŒ">åƒè‘‰çœŒ</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-gray-700 font-bold mb-2">å¹´é–“ç¤¾ä¼šä¿é™ºæ–™</label>
                                        <input
                                            type="number"
                                            value={previousYearIncome.socialInsurance}
                                            onChange={(e) => setPreviousYearIncome({...previousYearIncome, socialInsurance: parseInt(e.target.value) || 0})}
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                            placeholder="ä¾‹: 450000"
                                        />
                                    </div>
                                </div>
                            </div>
                            
                            {/* è¨ˆç®—ãƒœã‚¿ãƒ³ */}
                            <button
                                onClick={calculateSalary}
                                className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-lg font-bold text-lg hover:opacity-90"
                            >
                                ğŸ“Š è¨ˆç®—ã™ã‚‹
                            </button>
                        </div>
                        
                        {/* è¨ˆç®—çµæœ */}
                        {showResult && calculationResult && (
                            <div className="bg-white rounded-2xl shadow-lg p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-bold text-gray-800">çµ¦ä¸æ˜ç´°ï¼ˆè©³ç´°è¨ˆç®—ï¼‰</h2>
                                    <button
                                        onClick={printPayslip}
                                        className="bg-blue-500 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-600"
                                    >
                                        ğŸ“„ æ˜ç´°ã‚’ä¿å­˜
                                    </button>
                                </div>
                                
                                <div id="payslip-content" className="bg-white p-8">
                                    <div className="text-center mb-6">
                                        <h3 className="text-2xl font-bold">çµ¦ä¸æ˜ç´°æ›¸</h3>
                                        <p className="text-gray-600">{currentYear}å¹´{currentMonth + 1}æœˆåˆ†</p>
                                    </div>
                                    
                                    <div className="mb-4">
                                        <p className="text-lg"><strong>æ°å:</strong> {calculationResult.employee.name}</p>
                                    </div>
                                    
                                    <table className="w-full border-2 border-black mb-6">
                                        <thead>
                                            <tr className="bg-gray-200">
                                                <th className="border-2 border-black p-2">é …ç›®</th>
                                                <th className="border-2 border-black p-2 text-right">é‡‘é¡</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td className="border-2 border-black p-2">ç·æ”¯çµ¦é¡</td>
                                                <td className="border-2 border-black p-2 text-right">Â¥{calculationResult.totalWage.toLocaleString()}</td>
                                            </tr>
                                            <tr className="bg-gray-100">
                                                <td className="border-2 border-black p-2 font-bold">æ§é™¤</td>
                                                <td className="border-2 border-black p-2"></td>
                                            </tr>
                                            <tr>
                                                <td className="border-2 border-black p-2 pl-6">å¥åº·ä¿é™º</td>
                                                <td className="border-2 border-black p-2 text-right">Â¥{calculationResult.deductions.healthInsurance.toLocaleString()}</td>
                                            </tr>
                                            <tr>
                                                <td className="border-2 border-black p-2 pl-6">åšç”Ÿå¹´é‡‘</td>
                                                <td className="border-2 border-black p-2 text-right">Â¥{calculationResult.deductions.pension.toLocaleString()}</td>
                                            </tr>
                                            <tr>
                                                <td className="border-2 border-black p-2 pl-6">é›‡ç”¨ä¿é™º</td>
                                                <td className="border-2 border-black p-2 text-right">Â¥{calculationResult.deductions.employmentInsurance.toLocaleString()}</td>
                                            </tr>
                                            <tr>
                                                <td className="border-2 border-black p-2 pl-6">æ‰€å¾—ç¨</td>
                                                <td className="border-2 border-black p-2 text-right">Â¥{calculationResult.deductions.incomeTax.toLocaleString()}</td>
                                            </tr>
                                            <tr>
                                                <td className="border-2 border-black p-2 pl-6">ä½æ°‘ç¨</td>
                                                <td className="border-2 border-black p-2 text-right">Â¥{calculationResult.deductions.residentTax.toLocaleString()}</td>
                                            </tr>
                                            {calculationResult.deductions.rent > 0 && (
                                                <tr>
                                                    <td className="border-2 border-black p-2 pl-6">å®¶è³ƒ</td>
                                                    <td className="border-2 border-black p-2 text-right">Â¥{calculationResult.deductions.rent.toLocaleString()}</td>
                                                </tr>
                                            )}
                                            {calculationResult.deductions.utilities > 0 && (
                                                <tr>
                                                    <td className="border-2 border-black p-2 pl-6">å…‰ç†±è²»</td>
                                                    <td className="border-2 border-black p-2 text-right">Â¥{calculationResult.deductions.utilities.toLocaleString()}</td>
                                                </tr>
                                            )}
                                            <tr className="bg-gray-100">
                                                <td className="border-2 border-black p-2 font-bold">æ§é™¤åˆè¨ˆ</td>
                                                <td className="border-2 border-black p-2 text-right font-bold">Â¥{calculationResult.deductions.totalDeductions.toLocaleString()}</td>
                                            </tr>
                                            <tr className="bg-yellow-100">
                                                <td className="border-2 border-black p-2 font-bold text-lg">å·®å¼•æ”¯çµ¦é¡</td>
                                                <td className="border-2 border-black p-2 text-right font-bold text-lg">Â¥{calculationResult.netPay.toLocaleString()}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    
                                    {/* ä½æ°‘ç¨è¨ˆç®—è©³ç´° */}
                                    {calculationResult.deductions.details.previousYearIncome && (
                                        <div className="border-t-2 pt-4 mt-4">
                                            <h4 className="font-bold text-lg mb-2">ä½æ°‘ç¨è¨ˆç®—è©³ç´°</h4>
                                            <table className="w-full text-sm">
                                                <tbody>
                                                    <tr>
                                                        <td className="p-1">å‰å¹´ï¼ˆ{previousYearIncome.year}å¹´ï¼‰ç·åå…¥:</td>
                                                        <td className="p-1 text-right">Â¥{calculationResult.deductions.details.previousYearIncome.toLocaleString()}</td>
                                                    </tr>
                                                    <tr>
                                                        <td className="p-1">çµ¦ä¸æ‰€å¾—æ§é™¤:</td>
                                                        <td className="p-1 text-right">-Â¥{calculationResult.deductions.details.employmentIncomeDeduction.toLocaleString()}</td>
                                                    </tr>
                                                    <tr>
                                                        <td className="p-1">çµ¦ä¸æ‰€å¾—:</td>
                                                        <td className="p-1 text-right">Â¥{calculationResult.deductions.details.employmentIncome.toLocaleString()}</td>
                                                    </tr>
                                                    <tr>
                                                        <td className="p-1">ç¤¾ä¼šä¿é™ºæ–™æ§é™¤:</td>
                                                        <td className="p-1 text-right">-Â¥{calculationResult.deductions.details.socialInsuranceDeduction.toLocaleString()}</td>
                                                    </tr>
                                                    <tr>
                                                        <td className="p-1">åŸºç¤æ§é™¤:</td>
                                                        <td className="p-1 text-right">-Â¥{calculationResult.deductions.details.baseDeduction.toLocaleString()}</td>
                                                    </tr>
                                                    <tr className="border-t">
                                                        <td className="p-1 font-bold">èª²ç¨æ‰€å¾—:</td>
                                                        <td className="p-1 text-right font-bold">Â¥{calculationResult.deductions.details.taxableIncome.toLocaleString()}</td>
                                                    </tr>
                                                    <tr>
                                                        <td className="p-1">å¹´é–“ä½æ°‘ç¨ï¼ˆæ‰€å¾—å‰²10% + å‡ç­‰å‰²ï¼‰:</td>
                                                        <td className="p-1 text-right">Â¥{calculationResult.deductions.details.annualResidentTax.toLocaleString()}</td>
                                                    </tr>
                                                    <tr className="border-t">
                                                        <td className="p-1 font-bold">æœˆé¡ä½æ°‘ç¨ï¼ˆ12å›æ‰•ã„ï¼‰:</td>
                                                        <td className="p-1 text-right font-bold">Â¥{calculationResult.deductions.details.monthlyResidentTax.toLocaleString()}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<DetailedSalaryCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
