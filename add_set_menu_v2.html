<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ã‚»ãƒƒãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ ï¼ˆ1å€‹ãšã¤ï¼‰</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
    }
    h1 {
      color: #333;
    }
    .controls {
      margin: 20px 0;
      padding: 20px;
      background: #f0f0f0;
      border-radius: 8px;
    }
    button {
      padding: 15px 30px;
      font-size: 16px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #45a049;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .stop-btn {
      background: #f44336;
    }
    .stop-btn:hover {
      background: #da190b;
    }
    #result {
      margin-top: 20px;
      padding: 20px;
      background: #fff;
      border: 2px solid #ddd;
      border-radius: 8px;
      max-height: 600px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 14px;
    }
    .log-item {
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }
    .success {
      color: #4CAF50;
      font-weight: bold;
    }
    .error {
      color: #f44336;
      font-weight: bold;
    }
    .info {
      color: #2196F3;
    }
    .progress {
      margin: 20px 0;
      font-size: 18px;
      font-weight: bold;
      color: #333;
    }
    .current-item {
      background: #fff3cd;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      border-left: 4px solid #ffc107;
    }
  </style>
</head>
<body>
  <h1>ã‚»ãƒƒãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ ï¼ˆ1å€‹ãšã¤ç¢ºèªï¼‰</h1>
  
  <div class="controls">
    <div class="progress" id="progress">æº–å‚™å®Œäº†</div>
    <div class="current-item" id="current" style="display: none;"></div>
    
    <button id="startBtn" onclick="startAdding()">è¿½åŠ é–‹å§‹</button>
    <button id="stopBtn" onclick="stopAdding()" class="stop-btn" disabled>ä¸€æ™‚åœæ­¢</button>
    <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
  </div>
  
  <div id="result"></div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDihde65cnLva8l9tvi4u0oUM0gQ49bWNk",
      authDomain: "takoyaki-pos.firebaseapp.com",
      projectId: "takoyaki-pos",
      storageBucket: "takoyaki-pos.firebasestorage.app",
      messagingSenderId: "868693716352",
      appId: "1:868693716352:web:51d8c09ac51a7c8bc2a17c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    window.db = db;
    window.collection = collection;
    window.addDoc = addDoc;
    window.getDocs = getDocs;
    
    console.log('âœ… FirebaseåˆæœŸåŒ–å®Œäº†');
  </script>

  <script>
    let isRunning = false;
    let shouldStop = false;
    
    // è¿½åŠ ã™ã‚‹ãƒ‡ãƒ¼ã‚¿
    const allData = {
      toppings: [
        // ãƒ‰ãƒªãƒ³ã‚¯ï¼ˆ10å€‹ï¼‰
        { id: 'OTUMAMI_DRINK01', name: 'ã€ãƒ‰ãƒªãƒ³ã‚¯ã€‘ç”Ÿãƒ“ãƒ¼ãƒ«', price: 0, order: 101 },
        { id: 'OTUMAMI_DRINK02', name: 'ã€ãƒ‰ãƒªãƒ³ã‚¯ã€‘ãƒãƒ¥ãƒ¼ãƒã‚¤ãƒ—ãƒ¬ãƒ¼ãƒ³', price: 0, order: 102 },
        { id: 'OTUMAMI_DRINK03', name: 'ã€ãƒ‰ãƒªãƒ³ã‚¯ã€‘ãƒãƒ¥ãƒ¼ãƒã‚¤ã‚†ãš', price: 0, order: 103 },
        { id: 'OTUMAMI_DRINK04', name: 'ã€ãƒ‰ãƒªãƒ³ã‚¯ã€‘ãƒãƒ¥ãƒ¼ãƒã‚¤ã‚°ãƒ¬ãƒ¼ãƒ—ãƒ•ãƒ«ãƒ¼ãƒ„', price: 0, order: 104 },
        { id: 'OTUMAMI_DRINK05', name: 'ã€ãƒ‰ãƒªãƒ³ã‚¯ã€‘ãƒãƒ¥ãƒ¼ãƒã‚¤é’ã‚Šã‚“ã”', price: 0, order: 105 },
        { id: 'OTUMAMI_DRINK06', name: 'ã€ãƒ‰ãƒªãƒ³ã‚¯ã€‘ãƒãƒ¥ãƒ¼ãƒã‚¤æ¢…', price: 0, order: 106 },
        { id: 'OTUMAMI_DRINK07', name: 'ã€ãƒ‰ãƒªãƒ³ã‚¯ã€‘ãƒãƒ¥ãƒ¼ãƒã‚¤ã‚«ãƒ«ãƒ”ã‚¹', price: 0, order: 107 },
        { id: 'OTUMAMI_DRINK08', name: 'ã€ãƒ‰ãƒªãƒ³ã‚¯ã€‘è§’ãƒã‚¤', price: 0, order: 108 },
        { id: 'OTUMAMI_DRINK09', name: 'ã€ãƒ‰ãƒªãƒ³ã‚¯ã€‘ã‚¸ãƒ ãƒ“ãƒ¼ãƒ ', price: 0, order: 109 },
        { id: 'OTUMAMI_DRINK10', name: 'ã€ãƒ‰ãƒªãƒ³ã‚¯ã€‘ã‚¦ãƒ¼ãƒ­ãƒ³ãƒã‚¤', price: 0, order: 110 },
        // ãŸã“ç„¼ãå‘³ï¼ˆ5å€‹ï¼‰
        { id: 'OTUMAMI_TASTE01', name: 'ã€ãŸã“ç„¼ãå‘³ã€‘ã‚½ãƒ¼ã‚¹', price: 0, order: 201 },
        { id: 'OTUMAMI_TASTE02', name: 'ã€ãŸã“ç„¼ãå‘³ã€‘ã—ã‚‡ã†ã‚†', price: 0, order: 202 },
        { id: 'OTUMAMI_TASTE03', name: 'ã€ãŸã“ç„¼ãå‘³ã€‘å¡©', price: 0, order: 203 },
        { id: 'OTUMAMI_TASTE04', name: 'ã€ãŸã“ç„¼ãå‘³ã€‘ãƒãƒ³é…¢', price: 30, order: 204 },
        { id: 'OTUMAMI_TASTE05', name: 'ã€ãŸã“ç„¼ãå‘³ã€‘ã¿ãã ã‚Œ', price: 30, order: 205 },
        // ä¸€å“ï¼ˆ6å€‹ï¼‰
        { id: 'OTUMAMI_SIDE01', name: 'ã€ä¸€å“ã€‘æè±†', price: 0, order: 301 },
        { id: 'OTUMAMI_SIDE02', name: 'ã€ä¸€å“ã€‘æšã’ã«ã‚“ã«ã', price: 0, order: 302 },
        { id: 'OTUMAMI_SIDE03', name: 'ã€ä¸€å“ã€‘ã”ã¾æ²¹ã‚­ãƒ ãƒ', price: 0, order: 303 },
        { id: 'OTUMAMI_SIDE04', name: 'ã€ä¸€å“ã€‘å†·å¥´', price: 0, order: 304 },
        { id: 'OTUMAMI_SIDE05', name: 'ã€ä¸€å“ã€‘ãƒãƒ†ãƒˆãƒ•ãƒ©ã‚¤', price: 0, order: 305 },
        { id: 'OTUMAMI_SIDE06', name: 'ã€ä¸€å“ã€‘å”æšã’2å€‹', price: 0, order: 306 },
        // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆ2å€‹ï¼‰
        { id: 'OTUMAMI_OPT01', name: 'ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€‘ç”Ÿãƒ“ãƒ¼ãƒ«ãŠå¾—ã‚¸ãƒ§ãƒƒã‚­ã«å¤‰æ›´', price: 150, order: 401 },
        { id: 'OTUMAMI_OPT02', name: 'ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€‘ãã®ä»–ãƒ¡ã‚¬ã«å¤‰æ›´', price: 300, order: 402 }
      ],
      menus: [] // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯å¾Œã§è¿½åŠ 
    };
    
    function log(message, type = 'info') {
      const resultDiv = document.getElementById('result');
      const timestamp = new Date().toLocaleTimeString();
      const div = document.createElement('div');
      div.className = `log-item ${type}`;
      div.textContent = `[${timestamp}] ${message}`;
      resultDiv.appendChild(div);
      resultDiv.scrollTop = resultDiv.scrollHeight;
      console.log(message);
    }
    
    function updateProgress(current, total, phase) {
      const progressDiv = document.getElementById('progress');
      progressDiv.textContent = `${phase}: ${current}/${total}`;
    }
    
    function showCurrent(item) {
      const currentDiv = document.getElementById('current');
      currentDiv.style.display = 'block';
      currentDiv.textContent = `å‡¦ç†ä¸­: ${item.name || item.id}`;
    }
    
    function clearLog() {
      document.getElementById('result').innerHTML = '';
      log('ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
    }
    
    function stopAdding() {
      shouldStop = true;
      document.getElementById('stopBtn').disabled = true;
      log('â¸ï¸ ä¸€æ™‚åœæ­¢ã—ã¾ã™...', 'info');
    }
    
    async function startAdding() {
      if (isRunning) {
        alert('æ—¢ã«å®Ÿè¡Œä¸­ã§ã™');
        return;
      }
      
      isRunning = true;
      shouldStop = false;
      document.getElementById('startBtn').disabled = true;
      document.getElementById('stopBtn').disabled = false;
      
      log('ğŸš€ è¿½åŠ å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™', 'info');
      log('', 'info');
      
      try {
        // ãƒ•ã‚§ãƒ¼ã‚º1: ãƒˆãƒƒãƒ”ãƒ³ã‚°è¿½åŠ 
        log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
        log('ğŸ“¦ ãƒ•ã‚§ãƒ¼ã‚º1: ãƒˆãƒƒãƒ”ãƒ³ã‚°è¿½åŠ ', 'info');
        log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
        
        const toppings = allData.toppings;
        let successCount = 0;
        let errorCount = 0;
        
        for (let i = 0; i < toppings.length; i++) {
          if (shouldStop) {
            log('â¸ï¸ å‡¦ç†ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ', 'info');
            break;
          }
          
          const topping = toppings[i];
          updateProgress(i + 1, toppings.length, 'ãƒˆãƒƒãƒ”ãƒ³ã‚°è¿½åŠ ');
          showCurrent(topping);
          
          try {
            const docRef = await window.addDoc(window.collection(window.db, 'toppings'), topping);
            successCount++;
            log(`âœ… ${topping.name} (ID: ${topping.id})`, 'success');
            
            // 1ç§’å¾…æ©Ÿï¼ˆç¢ºèªã—ã‚„ã™ãã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™å›é¿ï¼‰
            await new Promise(resolve => setTimeout(resolve, 1000));
            
          } catch (error) {
            errorCount++;
            log(`âŒ ã‚¨ãƒ©ãƒ¼: ${topping.name} - ${error.message}`, 'error');
            
            // ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰2ç§’å¾…æ©Ÿ
            await new Promise(resolve => setTimeout(resolve, 2000));
          }
        }
        
        log('', 'info');
        log(`ãƒˆãƒƒãƒ”ãƒ³ã‚°è¿½åŠ å®Œäº†: æˆåŠŸ=${successCount}, å¤±æ•—=${errorCount}`, 'info');
        log('', 'info');
        
        if (shouldStop) {
          isRunning = false;
          document.getElementById('startBtn').disabled = false;
          document.getElementById('stopBtn').disabled = true;
          document.getElementById('current').style.display = 'none';
          return;
        }
        
        // ãƒ•ã‚§ãƒ¼ã‚º2: æ—¢å­˜ã®ãŸã“ç„¼ãå‘³ãƒˆãƒƒãƒ”ãƒ³ã‚°IDå–å¾—
        log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
        log('ğŸ” ãƒ•ã‚§ãƒ¼ã‚º2: æ—¢å­˜ãƒˆãƒƒãƒ”ãƒ³ã‚°ç¢ºèª', 'info');
        log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
        
        const toppingsSnapshot = await window.getDocs(window.collection(window.db, 'toppings'));
        let tasteTopping = '';
        
        toppingsSnapshot.forEach(doc => {
          const data = doc.data();
          if (data.name && data.name.includes('ã‚½ãƒ¼ã‚¹') && !data.id.startsWith('OTUMAMI_')) {
            if (!tasteTopping) {
              tasteTopping = data.id;
              log(`æ—¢å­˜ã®ãŸã“ç„¼ãå‘³ãƒˆãƒƒãƒ”ãƒ³ã‚°ID: ${tasteTopping}`, 'info');
            }
          }
        });
        
        if (!tasteTopping) {
          tasteTopping = 'OTUMAMI_TASTE01,OTUMAMI_TASTE02,OTUMAMI_TASTE03,OTUMAMI_TASTE04,OTUMAMI_TASTE05';
          log(`æ—¢å­˜ãƒˆãƒƒãƒ”ãƒ³ã‚°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€æ–°è¦IDä½¿ç”¨: ${tasteTopping}`, 'info');
        }
        
        // ãŠã¤ã¾ã¿ã‚»ãƒƒãƒˆç”¨ã®ãƒˆãƒƒãƒ”ãƒ³ã‚°IDãƒªã‚¹ãƒˆ
        const toppingIds = [];
        for (let i = 1; i <= 10; i++) {
          toppingIds.push(`OTUMAMI_DRINK${String(i).padStart(2, '0')}`);
        }
        for (let i = 1; i <= 5; i++) {
          toppingIds.push(`OTUMAMI_TASTE${String(i).padStart(2, '0')}`);
        }
        for (let i = 1; i <= 6; i++) {
          toppingIds.push(`OTUMAMI_SIDE${String(i).padStart(2, '0')}`);
        }
        toppingIds.push('OTUMAMI_OPT01', 'OTUMAMI_OPT02');
        const otumamisetToppingIds = toppingIds.join(',');
        
        log('', 'info');
        
        // ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ 
        log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
        log('ğŸ½ï¸ ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ ', 'info');
        log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
        
        const menus = [
          {
            id: 'SET001',
            category: 'ã‚»ãƒƒãƒˆ',
            name: 'Aã‚»ãƒƒãƒˆ',
            price: 1000,
            toppingsId: tasteTopping,
            image: '',
            note: 'åº—å†…ã®ã¿'
          },
          {
            id: 'SET002',
            category: 'ã‚»ãƒƒãƒˆ',
            name: 'Bã‚»ãƒƒãƒˆ',
            price: 1250,
            toppingsId: tasteTopping,
            image: '',
            note: 'åº—å†…ã®ã¿'
          },
          {
            id: 'SET003',
            category: 'ã‚»ãƒƒãƒˆ',
            name: 'ãŠã¤ã¾ã¿ã‚»ãƒƒãƒˆ',
            price: 1000,
            toppingsId: otumamisetToppingIds,
            image: '',
            note: 'åº—å†…ã®ã¿'
          }
        ];
        
        for (let i = 0; i < menus.length; i++) {
          if (shouldStop) {
            log('â¸ï¸ å‡¦ç†ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ', 'info');
            break;
          }
          
          const menu = menus[i];
          updateProgress(i + 1, menus.length, 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ ');
          showCurrent(menu);
          
          try {
            const docRef = await window.addDoc(window.collection(window.db, 'menu'), menu);
            log(`âœ… ${menu.name} (${menu.price}å††)`, 'success');
            
            // 1ç§’å¾…æ©Ÿ
            await new Promise(resolve => setTimeout(resolve, 1000));
            
          } catch (error) {
            log(`âŒ ã‚¨ãƒ©ãƒ¼: ${menu.name} - ${error.message}`, 'error');
            
            // ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰2ç§’å¾…æ©Ÿ
            await new Promise(resolve => setTimeout(resolve, 2000));
          }
        }
        
        log('', 'info');
        log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'success');
        log('ğŸ‰ å…¨ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');
        log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'success');
        log('', 'info');
        log('âœ… è¿½åŠ ã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼:', 'success');
        log('  - Aã‚»ãƒƒãƒˆ (1000å††)', 'success');
        log('  - Bã‚»ãƒƒãƒˆ (1250å††)', 'success');
        log('  - ãŠã¤ã¾ã¿ã‚»ãƒƒãƒˆ (1000å††)', 'success');
        log('', 'info');
        log('ğŸ“± ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ—ãƒªã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ç¢ºèªã—ã¦ãã ã•ã„', 'info');
        
      } catch (error) {
        log(`âŒ è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
        console.error('ã‚¨ãƒ©ãƒ¼è©³ç´°:', error);
      }
      
      isRunning = false;
      document.getElementById('startBtn').disabled = false;
      document.getElementById('stopBtn').disabled = true;
      document.getElementById('current').style.display = 'none';
      updateProgress(0, 0, 'å®Œäº†');
    }
    
    window.startAdding = startAdding;
    window.stopAdding = stopAdding;
    window.clearLog = clearLog;
  </script>
</body>
</html>
